{
  "hash": "18d227e58fa58c163b8cb3e410f33b91",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 2: Discovering impacts of COVID-19 on Thailand tourism economy at the province level using spatial and spatio-temporal statistics\"\nauthor: \"Leng Yi Xiu\"\ndate: \"Oct 14 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  freeze: true\n---\n\n\n# 1 Overview\n\nTourism is a major industry in Thailand, contributing around 20% to the country's gross domestic product (GDP). In 2019, Thailand generated 90 billion US dollars from both domestic and international tourism. However, due to the COVID-19 pandemic, this revenue sharply declined to 24 billion US dollars in 2020.\n\nIt's also important to recognize that Thailand's tourism economy is not evenly distributed across the country. The tourism economy of Thailand is mainly focused on five provinces, namely Bangkok, Phuket, Chiang Mai, Sukhothai and Phetchaburi.\n\n## 1.1 Objective\n\nThe objective of this exercise is to explore whether key indicators of Thailand's tourism economy are independent of spatial and spatio-temporal factors. If dependencies exist, we want to identify clusters, outliers, and emerging hot or cold spots. The exercise involves the following tasks:\n\n-   Create a geospatial data layer of Thailand's provinces (including Bangkok) as an *`sf`* polygon layer.\n\n-   Develop a tourism economy indicators layer for the study area, also in *`sf`* polygon features.\n\n-   Derive a tourism economy indicator layer in a spatio-temporal format (*`spacetime s3 class`*) using *`sfdep`*, maintaining a monthly and yearly time series.\n\n-   Perform **global spatial autocorrelation analysis** using *`sfdep`* to determine overall spatial dependence.\n\n-   Conduct **local spatial autocorrelation analysis** to detect specific clusters and outliers.\n\n-   Carry out an **emerging hotspot analysis** to identify trends in hot or cold spots over time\n\n-   Describe the spatial patterns revealed by the analysis above.\n\n------------------------------------------------------------------------\n\n# 2 Getting Started\n\nThe code chunk below installs and loads **sf, spdep, ggstatsplot, tmap, tidyverse, knitr, GWmodel** packages into R environment\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, ggstatsplot, tmap, tidyverse, knitr, GWmodel)\n```\n:::\n\n\n------------------------------------------------------------------------\n\n# 3 Data Preparation\n\nFor the purpose of this exercise, we will be using two data sets:\n\n-   Thailand Domestic Tourism Statistics (**thaitour**)\\\n    The dataset contains statistics on domestic tourism in Thailand, by province, from Jan 2019 to Feb 2023. Information includes the number of tourists, the occupancy rate, the profits generated by tourism as well as the nationality of the tourists (Thai vs. foreign).\n\n-   Thailand Subnational Adminstrative Boundaries (**province**)\\\n    The dataset contains Thailand's administrative level 0 (country), 1 (province), 2 (district), and 3 (sub-district, tambon) boundaries.\n\n## 3.1 Importing data into R Environment\n\n::: panel-tabset\n## Tourism Statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthaitour <- read_csv (\"data/rawdata/thailand_domestic_tourism_2019_2023_ver2.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 30800 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (5): province_thai, province_eng, region_thai, region_eng, variable\ndbl  (1): value\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(thaitour)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n# A tibble: 30,800 × 7\n   date       province_thai province_eng   region_thai region_eng variable value\n   <date>     <chr>         <chr>          <chr>       <chr>      <chr>    <dbl>\n 1 2019-01-01 กรุงเทพมหานคร  Bangkok        ภาคกลาง     central    ratio_t…  93.4\n 2 2019-01-01 ลพบุรี          Lopburi        ภาคกลาง     central    ratio_t…  61.3\n 3 2019-01-01 พระนครศรีอยุธยา Phra Nakhon S… ภาคกลาง     central    ratio_t…  73.4\n 4 2019-01-01 สระบุรี         Saraburi       ภาคกลาง     central    ratio_t…  67.3\n 5 2019-01-01 ชัยนาท         Chainat        ภาคกลาง     central    ratio_t…  79.3\n 6 2019-01-01 นครปฐม        Nakhon Pathom  ภาคกลาง     central    ratio_t…  71.7\n 7 2019-01-01 สิงห์บุรี         Sing Buri      ภาคกลาง     central    ratio_t…  64.6\n 8 2019-01-01 อ่างทอง        Ang Thong      ภาคกลาง     central    ratio_t…  71.2\n 9 2019-01-01 นนทบุรี         Nonthaburi     ภาคกลาง     central    ratio_t…  75.1\n10 2019-01-01 ปทุมธานี        Pathum Thani   ภาคกลาง     central    ratio_t…  60.8\n# ℹ 30,790 more rows\n```\n\n\n:::\n:::\n\n\n💡To check the different attributes in the data set\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthaitour %>%\n  count(variable) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  variable               n\n  <chr>              <int>\n1 no_tourist_all      3850\n2 no_tourist_foreign  3850\n3 no_tourist_stay     3850\n4 no_tourist_thai     3850\n5 ratio_tourist_stay  3850\n6 revenue_all         3850\n7 revenue_foreign     3850\n8 revenue_thai        3850\n```\n\n\n:::\n:::\n\n\n💡To check the different provinces in the data set\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthaitour %>%\n  count(province_eng) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 77 × 2\n   province_eng      n\n   <chr>         <int>\n 1 Amnat Charoen   400\n 2 Ang Thong       400\n 3 Bangkok         400\n 4 Bueng Kan       400\n 5 Buriram         400\n 6 Chachoengsao    400\n 7 Chainat         400\n 8 Chaiyaphum      400\n 9 Chanthaburi     400\n10 Chiang Mai      400\n# ℹ 67 more rows\n```\n\n\n:::\n:::\n\n\n## Administrative Boundaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprovince <- st_read(dsn = \"data/rawdata\", layer = \"tha_admbnda_adm1_rtsd_20220121\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm1_rtsd_20220121' from data source \n  `D:\\2. SMU - MITB\\Term 4\\ISSS626 Geospatial\\YX-Leng\\ISSS626-Geospatial\\Take-home_Ex\\Take-home_Ex02\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(province) <- 4326 \nprovince <- st_transform(province, crs = 32647)\nhead(province,5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 5 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 630867.9 ymin: 1490796 xmax: 712440.5 ymax: 1622722\nProjected CRS: WGS 84 / UTM zone 47N\n  Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE\n1   2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10\n2   1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11\n3   1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12\n4   1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13\n5   3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14\n  ADM1_REF ADM1ALT1EN ADM1ALT2EN ADM1ALT1TH ADM1ALT2TH  ADM0_EN   ADM0_TH\n1     <NA>       <NA>       <NA>       <NA>       <NA> Thailand ประเทศไทย\n2     <NA>       <NA>       <NA>       <NA>       <NA> Thailand ประเทศไทย\n3     <NA>       <NA>       <NA>       <NA>       <NA> Thailand ประเทศไทย\n4     <NA>       <NA>       <NA>       <NA>       <NA> Thailand ประเทศไทย\n5     <NA>       <NA>       <NA>       <NA>       <NA> Thailand ประเทศไทย\n  ADM0_PCODE       date    validOn    validTo                       geometry\n1         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((674339.8 15...\n2         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((687139.8 15...\n3         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((644817.9 15...\n4         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((704086 1575...\n5         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((662941.6 16...\n```\n\n\n:::\n:::\n\n:::\n\n## 3.2 Data Wrangling\n\n### *3.2.1 Check for duplicates*\n\nTo ensure no duplicate rows are presented and only the English columns are selected, the following code chunk is used:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthaitour <- thaitour %>% \n  distinct() %>% \n        select(date,province_eng,region_eng,variable,value)\n```\n:::\n\n\n### *3.2.2 Perform Relational Join*\n\nPerform a left join of both data sets and select only columns that will be used in analysis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai <- left_join(thaitour,province,\n                  by = c(\"province_eng\" = \"ADM1_EN\")) %>%\n  select(1:7,21)\n```\n:::\n\n\n### *3.2.3 Filter for missing, mismatched values*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter_thai <- thai %>%\n  filter(is.na(Shape_Area))\n\nfilter_thai %>%\n  distinct(province_eng) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 1\n  province_eng   \n  <chr>          \n1 Lopburi        \n2 Chainat        \n3 Chonburi       \n4 Prachinburi    \n5 Phang Nga      \n6 Buriram        \n7 Sisaket        \n8 Nong Bua Lamphu\n```\n\n\n:::\n:::\n\n\n::: callout-important\n## Findings\n\nThe above code chunk filters for rows with empty Shape_Area and Geometry - this is indicative that there are mismatches between the 2 data sets and the province name are not compatible between the Tourism Statistics and Administrative Boundaries.\n\nThe 8 provinces have been misspelled in the Tourism Statistics data set and will need to be corrected before the data sets can be merged correctly.\n:::\n\n### *3.2.4 Correct province names in Tourism Statistics*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthaitour_v2 <- thaitour %>%\n  mutate(province_eng = case_when(\n    province_eng == \"Lopburi\" ~ \"Lop Buri\",\n    province_eng == \"Chainat\" ~ \"Chai Nat\",\n    province_eng == \"Chonburi\" ~ \"Chon Buri\",\n    province_eng == \"Prachinburi\" ~ \"Prachin Buri\",\n    province_eng == \"Phang Nga\" ~ \"Phangnga\",\n    province_eng == \"Buriram\" ~ \"Buri Ram\",\n    province_eng == \"Sisaket\" ~ \"Si Sa Ket\",\n    province_eng == \"Nong Bua Lamphu\" ~ \"Nong Bua Lam Phu\",\n    TRUE ~ province_eng  # Keep all other values unchanged\n  ))\n```\n:::\n\n\n### *3.2.5 Perform Relational Join and check that no more mismatched provinces*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_v2 <- left_join(thaitour_v2,province,\n                  by = c(\"province_eng\" = \"ADM1_EN\")) %>%\n  select(1:7,21)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolSums(is.na(thai_v2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      date.x province_eng   region_eng     variable        value   Shape_Leng \n           0            0            0            0            0            0 \n  Shape_Area     geometry \n           0            0 \n```\n\n\n:::\n:::\n\n\n### *3.2.6 Check for values less than zero*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalue_neg <- thai_v2 %>%\n  filter(value < 0)\n\nvalue_neg\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 8\n  date.x     province_eng  region_eng variable       value Shape_Leng Shape_Area\n  <date>     <chr>         <chr>      <chr>          <dbl>      <dbl>      <dbl>\n1 2021-07-01 Nakhon Pathom central    revenue_forei… -4250       2.46      0.179\n2 2021-08-01 Nakhon Pathom central    revenue_forei… -4250       2.46      0.179\n# ℹ 1 more variable: geometry <MULTIPOLYGON [m]>\n```\n\n\n:::\n:::\n\n\n::: callout-important\n## Findings\n\nThe above code chunk filters out 2 records of foreign revenue where the value is negative. For purpose of analysis in this exercise, these 2 records will be corrected to zero as revenue should not be negative.\n\nFinal data set will remain with 30,800 observations.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_v2 <- thai_v2 %>%\n  mutate(value = pmax(value, 0))\n```\n:::\n\n\n### *3.2.7 Split out the 8 attributes to unique columns*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_final <- thai_v2 %>%\n  pivot_wider(names_from = variable, values_from = value)\nprint(thai_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3,850 × 14\n   date.x     province_eng             region_eng Shape_Leng Shape_Area\n   <date>     <chr>                    <chr>           <dbl>      <dbl>\n 1 2019-01-01 Bangkok                  central          2.42     0.131 \n 2 2019-01-01 Lop Buri                 central          5.69     0.546 \n 3 2019-01-01 Phra Nakhon Si Ayutthaya central          3.04     0.214 \n 4 2019-01-01 Saraburi                 central          4.77     0.292 \n 5 2019-01-01 Chai Nat                 central          2.90     0.209 \n 6 2019-01-01 Nakhon Pathom            central          2.46     0.179 \n 7 2019-01-01 Sing Buri                central          1.78     0.0687\n 8 2019-01-01 Ang Thong                central          1.74     0.0792\n 9 2019-01-01 Nonthaburi               central          1.25     0.0532\n10 2019-01-01 Pathum Thani             central          1.88     0.127 \n# ℹ 3,840 more rows\n# ℹ 9 more variables: geometry <MULTIPOLYGON [m]>, ratio_tourist_stay <dbl>,\n#   no_tourist_stay <dbl>, no_tourist_all <dbl>, no_tourist_thai <dbl>,\n#   no_tourist_foreign <dbl>, revenue_all <dbl>, revenue_thai <dbl>,\n#   revenue_foreign <dbl>\n```\n\n\n:::\n:::\n\n\n### *3.2.8 Save transformed data in rds folder*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(thai_final, \"data/rds/thai_final.rds\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n# 4 Exploratory Data Analysis (EDA)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}